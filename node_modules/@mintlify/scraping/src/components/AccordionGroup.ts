import type { Element } from 'hast';

import type { HastNode, HastNodeIndex, HastNodeParent } from '../types/hast.js';

export function gitBookScrapeAccordionGroup(
  node: HastNode,
  _: HastNodeIndex,
  parent: HastNodeParent
): Element | undefined {
  if (node.tagName !== 'Accordion') return undefined;
  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition
  if (!parent || !parent.children) return undefined;

  let accordionCount = 0;
  for (const child of parent.children) {
    if (child.type === 'element' && child.tagName === 'Accordion') accordionCount++;
  }

  if (accordionCount === parent.children.length) {
    parent.type = 'element';
    (parent as Element).tagName = 'AccordionGroup';
  }

  return undefined;
}

export function readmeScrapeAccordionGroup(
  node: HastNode,
  _: HastNodeIndex,
  parent: HastNodeParent
): Element | undefined {
  if (node.tagName !== 'Accordion') return undefined;
  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition
  if (!parent || !parent.children) return undefined;

  let accordionCount = 0;
  for (const child of parent.children) {
    if (child.type === 'element' && child.tagName === 'Accordion') accordionCount++;
  }

  if (accordionCount === parent.children.length) {
    parent.type = 'element';
    (parent as Element).tagName = 'AccordionGroup';
  }

  return undefined;
}

export function docusaurusScrapeAccordionGroup(
  node: HastNode,
  _: HastNodeIndex,
  parent: HastNodeParent
): Element | undefined {
  if (node.tagName !== 'Accordion') return undefined;
  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition
  if (!parent || !parent.children) return undefined;

  let accordionCount = 0;
  for (const child of parent.children) {
    if (child.type === 'element' && child.tagName === 'Accordion') accordionCount++;
  }

  if (accordionCount === parent.children.length) {
    parent.type = 'element';
    (parent as Element).tagName = 'AccordionGroup';
  }

  return undefined;
}
