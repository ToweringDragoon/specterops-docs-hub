---
title: Integrate the BloodHound Enterprise Splunk app
description: Learn how to install and configure the BloodHound Enterprise Splunk app to ingest BloodHound Enterprise data into Splunk.
sidebarTitle: Install and configure
---

<img noZoom src="/assets/enterprise-edition-pill-tag.svg" alt="Applies to BloodHound Enterprise only"/>

The [BloodHound Enterprise Splunk app](https://splunkbase.splunk.com/app/7818) ingests your BloodHound Enterprise data into Splunk.

- Use the dashboards to track the Active Directory and Azure attack paths of your environment
- Create alerts to detect when new attack paths emerge or exposure increases
- Enrich your security information and event management (SIEM) data with information about the attack paths to and from principals in your environment

## Prerequisites

Before installing and configuring the BloodHound Enterprise Splunk app, ensure that you have the following:

- Splunk instance (version 9.0.1 or later) and an admin account
- BloodHound Enterprise tenant
- BloodHound Enterprise [non-personal API key/ID pair](https://github.com/SpecterOps/bloodhound-docs/blob/main//integrations/bloodhound-api/working-with-api#create-a-personal-api-key-and-id-pair) with the **Auditor** role

## Install the Splunk app

Installing the BloodHound Enterprise Splunk app involves the following steps:

<Steps>
  <Step title="Navigate to Splunk app management">
    1. Log in to Splunk Enterprise as an admin.
    1. Click **Apps** > **Manage apps**.
  </Step>

  <Step title="Install the BloodHound Enterprise Splunk app">
    Use one of the following methods to install the BloodHound Enterprise Splunk app:

      <Tabs>
        <Tab title="Splunkbase" icon="server">
        Install directly from Splunkbase:

          1. Click **Browse More Apps**.
          1. Search for _BloodHound Enterprise_.
          1. Click **Install**
          1. Enter your Splunkbase credentials to authorize the download when prompted.
        </Tab>

        <Tab title="Downloaded package" icon="download">
        Install from a downloaded package:

          1. Download the BloodHound Enterprise Splunk app package from [Splunkbase](https://splunkbase.splunk.com/app/7818).
          1. Click **Install App from File**.
          1. Select the downloaded package and click **Upload**.
        </Tab>
      </Tabs>
  </Step>

  <Step title="Restart Splunk">
    After installing the app, restart your Splunk instance to apply the changes.

    <Tip>See [Splunk's documentation](https://help.splunk.com/en/splunk-enterprise/administer/admin-manual/9.0/welcome-to-splunk-enterprise-administration/start-splunk-enterprise-and-perform-initial-tasks/start-and-stop-splunk-enterprise) for more information.</Tip>
  </Step>
</Steps>

## Configure the Splunk app (required)

This section describes the minimum required configuration steps to get the BloodHound Enterprise Splunk app up and running. It involves the following steps:

1. Configure a Splunk index
1. Configure Splunk app API credentials
1. Configure Splunk data inputs

<Note>Optional configurations are available in the [Configure the Splunk app (optional)](#configure-the-splunk-app-optional) section.</Note>

<Steps>
  <Step title="Configure a Splunk index">
    Create a dedicated index for the BloodHound Enterprise Splunk app data:

    1. Click **Settings** > **Indexes** > **New Index**.
    1. In the **Index Name** field, enter `bhe-splunk-app`.
    1. In the **Data Integrity Check** field, select **Enabled**.
    1. In the **App** field, select **BloodHound Enterprise**.
    1. Click **Save**.

        <Frame>
          <img
            src="/images/integrations/splunk/new-index-config.png"
            style={{ width:"70%" }}
            alt="A view of the Splunk 'New Index' configuration page showing the fields filled out for creating the 'bhe-splunk-app' index."
          />
        </Frame>
  </Step>

  <Step title="Configure Splunk app API credentials">
    Configure the BloodHound Enterprise Splunk app with your BloodHound Enterprise API credentials.
    
    <Note>We recommend a [non-personal API key/ID pair](https://github.com/SpecterOps/bloodhound-docs/blob/main//integrations/bloodhound-api/working-with-api#create-a-personal-api-key-and-id-pair) with the **Auditor** role for the Splunk integration.</Note>

    1. Click **Apps** > **Manage Apps**.
    1. Filter for the BloodHound Enterprise Splunk app and click on it.
    1. Click the **Administration** drop-down menu and select **Configuration**.
    1. Click **Add** to open the **Add Account** screen.
    1. Complete the configuration fields:

        | Field                 | Description                                              |
        |-----------------------|----------------------------------------------------------|
        | **Account Name**      | Unique name to identify the BloodHound Enterprise account in Splunk    |
        | **Tenant Domain**     | Your BloodHound Enterprise tenant (e.g., `https://mydomain.bloodhoundenterprise.io`) |
        | **Token ID**          | Token ID associated with the BloodHound Enterprise account |
        | **Token key**         | Token key associated with the BloodHound Enterprise account |

    1. Click **Save** to apply the configuration.

        <Frame>
          <img
            src="/images/integrations/splunk/add-account.png"
            style={{ width:"70%" }}
            alt="A view of the Splunk 'Add Account' page showing the fields configuring the app's API credentials."
          />
        </Frame>
  </Step>

  <Step title="Configure Splunk data inputs">
    Data inputs define what data the BloodHound Enterprise Splunk app collects from the BloodHound Enterprise API. 

    <Tip>You can create multiple inputs of the same type, each with different configurations (e.g., different BloodHound Enterprise accounts, indices, and collection intervals).</Tip>

    1. Click **Apps** > **Manage Apps**.
    1. Filter for the BloodHound Enterprise Splunk app and click on it.
    1. Click the **Administration** drop-down menu and select **Inputs**.
    1. Click **Create New Input**.
    1. Select an input type from the drop-down menu.

        The BloodHound Enterprise Splunk app supports the following input types:

          <table style={{ tableLayout: 'auto' }}>
            <thead>
              <tr>
                <th style={{ textAlign: 'left' }}>Input type</th>
                <th style={{ textAlign: 'left' }}>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Attack Paths</strong></td>
                <td>Retrieves a list of attack paths from the BloodHound Enterprise API and a list of various findings across a given time range.</td>
              </tr>
              <tr>
                <td><strong>Audit Logs</strong></td>
                <td>
                  Retrieves a list of audit logs from the BloodHound Enterprise API.
                  <ul>
                    <li>Requires the API user to have the either the <strong>Administrator</strong> or <strong>Auditor</strong> role in BHE.</li>
                    <li>You can set the "Historical Polling Days" field to retrieve logs from the past N days, starting from the current date.</li>
                    <li>After the app fetches all logs for the specified period, the input continues polling only the latest audit logs.</li>
                    <li>If you need logs from a different time range, you can create a new input and fetch them separately.</li>
                  </ul>
                </td>
              </tr>
              <tr>
                <td><strong>Tier Zero Assets</strong></td>
                <td>Ingests data for all asset members that belong to the Tier Zero privilege zone.</td>
              </tr>
              <tr>
                <td><strong>Posture Statistics</strong></td>
                <td>Retrieves a history of statistics stored in the database using the BloodHound Enterprise API.</td>
              </tr>
            </tbody>
          </table>
  
    1. Complete the configuration fields for the selected input type.

        The following table describes fields that are common across all input types:

        | Field                          | Description                                                             |
        |--------------------------------|-------------------------------------------------------------------------|
        | **Name**                       | Unique name identifying the input                                       |
        | **Interval**                   | Interval (in seconds) at which the input runs                           |
        | **Index**                      | Index where the BloodHound Enterprise data is stored (`bhe-splunk-app`). You must clear the `default` value and search for the correct index. |
        | **Bloodhound Account**         | Bloodhound Enterprise account name (configured in Splunk) that will be used to fetch the data      |

    1. Click **Add** to create the input.

        <Frame>
          <img
            src="/images/integrations/splunk/input-config.png"
            style={{ width:"70%" }}
            alt="A view of the Splunk 'Create New Input' configuration page showing the fields filled out for creating a new input."
          />
        </Frame>

        Repeat the above steps to create additional inputs as needed.

        Data will now begin flowing into the environment. You can monitor this progress through Splunk itself with the following query:

        ```spl
        index=_internal source="*splunkd.log" "BHE "
        ```
  </Step>
</Steps>

## Configure the Splunk app (optional)

This section describes optional configuration options for the BloodHound Enterprise Splunk app,  including:

1. Configure a Splunk search macro
1. Configure a Splunk proxy
1. Configure Splunk logging

<Steps>
  <Step title="Configure Splunk search macro">
    The BloodHound Enterprise Splunk app includes a [search macro](https://help.splunk.com/en/splunk-enterprise/manage-knowledge-objects/knowledge-management-manual/9.4/search-macros/use-search-macros-in-searches) (`bhe_index`) that points to the default index where Splunk stores BloodHound Enterprise data (`bhe-splunk-app`).

    <Frame>
      <img
        src="/images/integrations/splunk/search-macro.png"
        alt="A view of the Splunk 'Search Macros' page showing the default 'bhe_index' macro."
      />
    </Frame>

    To view or modify the search macro:

    1. Click **Settings** > **Advanced search**.
    1. Click **Search macros**.
    1. Filter for `bhe_index`.

        If you used a different index name, edit the macro **Definition** field to match that name.

        ```spl
        index=my_custom_bhe_index
        ```

        If you maintain separate indexes per input type, modify the macro definition accordingly. For example:

        ```spl
        index=attack_path_index OR index=audit_log_index OR index=posture_stats_index
        ```
  </Step>

  <Step title="Configure Splunk proxy">
    Splunk allows you to configure a proxy to route traffic through an intermediary server. This might be useful for network security and compliance requirements.

    1. Click **Apps** > **Manage Apps**.
    1. Filter for the BloodHound Enterprise Splunk app and click on it.
    1. Click the **Administration** drop-down menu and select **Configuration**.
    1. Click the **Proxy Settings** tab.
    1. Complete the configuration fields:

        | Field                    | Description                                             |
        |--------------------------|---------------------------------------------------------|
        | **Enable**               | Checkbox to enable or disable the proxy configuration   |
        | **Proxy Type**           | Drop-down to choose the type of proxy (http, socks4, socks5)|
        | **Host**                 | Enter the proxy hostname or IP address                  |
        | **Port**                 | Specify the port number (e.g., 8080)                    |
        | **Username**             | If authentication is required, enter the username       |
        | **Password**             | If authentication is required, enter the corresponding password |

    1. Click **Save** to apply the proxy settings.
    1. Restart Splunk.

        <Tip>See [Splunk's documentation](https://help.splunk.com/en/splunk-enterprise/administer/admin-manual/9.0/welcome-to-splunk-enterprise-administration/start-splunk-enterprise-and-perform-initial-tasks/start-and-stop-splunk-enterprise) for more information.</Tip>
    </Step>

  <Step title="Configure Splunk logging">
    You can configure logging settings for the BloodHound Enterprise Splunk app to help with troubleshooting and monitoring.

    1. Click **Apps** > **Manage Apps**.
    1. Filter for the BloodHound Enterprise Splunk app and click on it.
    1. Click the **Administration** drop-down menu and select **Configuration**.
    1. Click the **Logging** tab.
    1. Select one of the following options from the **Log level** drop-down menu:

        | Log level | Description |
        |-----------|-------------|
        | **DEBUG** | Most verbose; use for troubleshooting |
        | **INFO** | Standard logs (default) |
        | **WARNING** | Warnings only |
        | **ERROR** | Errors only |

    1. Click **Save** to apply the changes.

    The BloodHound Enterprise Splunk app writes logs to:

    ```text
    $SPLUNK_HOME/var/log/splunk/ta_bloodhound_enterprise_<input-name>.log
    ```

    You can search logs in Splunk using:

    ```spl
    index="_internal" sourcetype="ta_bloodhound_enterprise:log"
    ```

    Use the `tail` command to monitor logs in real-time:

    ```bash
    tail -f $SPLUNK_HOME/var/log/splunk/ta_bloodhound_enterprise_<input-name>.log
    ```
  </Step>
</Steps>

## Monitor and troubleshoot

The **BHE Integration Health** dashboard is designed to help you monitor and troubleshoot errors related to the BloodHound Enterprise Splunk app.

This dashboard provides real-time insights into the system failures, allowing you to quickly identify and resolve issues. It retrieves and displays error logs with the following Splunk query:

```spl
index=bhe-splunk-app sourcetype=BHE:error
```

<Note>This dashboard does not provide filters.</Note>

Here are some recommendations for using the **BHE Integration Health** dashboard to troubleshoot issues:

- Identify the function causing the error in the Detailed Error Logs table
- Look for recurring errors in Error Summary and Top Error Functions
- Apply the relevant steps above based on the error type
- If issues persist, inspect Splunk internal logs

<Note>See [Troubleshooting](https://github.com/SpecterOps/bloodhound-docs/blob/main//integrations/splunk/troubleshoot) for common issues and resolutions.</Note>

To access the **BHE Integration Health** Dashboard:

1. Log in to Splunk Enterprise as an admin.
1. Click **Apps** > **Manage apps**.
1. Filter for the BloodHound Enterprise Splunk app and click on it.
1. Click the **Administration** drop-down menu and select **BHE Integration Health Dashboard**.

### Error Trend Over Time

This panel shows a time chart of errors (by count) occurring in the BloodHound Enterprise Splunk app over time.

<Frame>
  <img 
    src="/images/integrations/splunk/error-trend-over-time.png"
    alt="A view of the Error Trend Over Time panel in the BloodHound Enterprise Splunk app"
  />
</Frame>

### Errors by Function

This panel shows a chart of errors (by function) generating errors in the BloodHound Enterprise Splunk app.

<Frame>
  <img 
    src="/images/integrations/splunk/errors-by-function.png"
    alt="A view of the Errors by Function panel in the BloodHound Enterprise Splunk app"
  />  
</Frame>

### Top 10 Frequent Errors

This panel shows a chart of the top ten most frequent error messages occurring in the BloodHound Enterprise Splunk app.

<Frame>
  <img 
    src="/images/integrations/splunk/top-10-frequent-errors.png"
    alt="A view of the Top 10 Frequent Errors panel in the BloodHound Enterprise Splunk app"
  />
</Frame>

### Raw Error Logs

This panel provides a detailed table of raw error logs generated by the BloodHound Enterprise, including timestamps, function names, and error messages.

<Frame>
  <img 
    src="/images/integrations/splunk/raw-error-logs.png"
    alt="A view of the Raw Error Logs panel in the BloodHound Enterprise Splunk app"
  />
</Frame>
